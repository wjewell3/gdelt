<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Bar Graphs</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        canvas {
            max-width: 500px;
            margin: 20px;
        }
    </style>
</head>
<body>

    <h2>Theme Count</h2>
    <canvas id="themeChart"></canvas>

    <h2>Tone Count</h2>
    <canvas id="toneChart"></canvas>

    <script>
        // Global object to store selected IDs
        const selectedIds = { themeIds: [], toneIds: [] };

        // Example data
        const data = {
            themes: [
                { id: 1, theme: "Theme 1", count: 5, toneCounts: { positive: 3, negative: 2 }, toneIds: [101, 102, 103, 104, 105] },
                { id: 2, theme: "Theme 2", count: 7, toneCounts: { positive: 5, negative: 2 }, toneIds: [106, 107, 108, 109, 110, 111, 112] }
            ],
            tones: [
                { id: 101, tone: "positive" },
                { id: 102, tone: "positive" },
                { id: 103, tone: "negative" },
                { id: 104, tone: "positive" },
                { id: 105, tone: "negative" },
                { id: 106, tone: "positive" },
                { id: 107, tone: "positive" },
                { id: 108, tone: "negative" },
                { id: 109, tone: "positive" },
                { id: 110, tone: "positive" },
                { id: 111, tone: "positive" },
                { id: 112, tone: "negative" }
            ]
        };

        // Helper function to create a chart
        function createChart(ctx, type, labels, data, options) {
            return new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Count',
                        data: data,
                        backgroundColor: ['#3498db', '#e74c3c'],
                    }]
                },
                options: options
            });
        }

        // Initialize the charts with the full dataset
        const themeChartCtx = document.getElementById('themeChart').getContext('2d');
        const toneChartCtx = document.getElementById('toneChart').getContext('2d');

        const themeChart = createChart(themeChartCtx, 'bar', data.themes.map(t => t.theme), data.themes.map(t => t.count), {
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    const index = elements[0].index;
                    const selectedTheme = data.themes[index];
                    
                    // Update global selectedIds object with the ids of the selected theme
                    selectedIds.themeIds = selectedTheme.toneIds;

                    // Clear toneIds as we are filtering based on theme selection
                    selectedIds.toneIds = [];

                    // Update all charts
                    updateCharts();
                }
            }
        });

        const toneChart = createChart(toneChartCtx, 'bar', ['positive', 'negative'], [data.tones.filter(t => t.tone === 'positive').length, data.tones.filter(t => t.tone === 'negative').length], {
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    const index = elements[0].index;
                    const selectedTone = ['positive', 'negative'][index];
                    
                    // Update global selectedIds object with the ids of the selected tone
                    selectedIds.toneIds = data.tones.filter(t => t.tone === selectedTone).map(t => t.id);

                    // Filter themeIds based on selected tone
                    selectedIds.themeIds = data.themes
                        .filter(theme => theme.toneIds.some(id => selectedIds.toneIds.includes(id)))
                        .map(theme => theme.id);

                    // Update all charts
                    updateCharts();
                }
            }
        });

        // Update all charts based on selectedIds
        function updateCharts() {
            // Filter themes by selected tone IDs if any
            const filteredThemes = data.themes.filter(theme => 
                selectedIds.toneIds.length === 0 || theme.toneIds.some(id => selectedIds.toneIds.includes(id))
            );
            themeChart.data.labels = filteredThemes.map(t => t.theme);
            themeChart.data.datasets[0].data = filteredThemes.map(t => t.count);
            themeChart.update();

            // Filter tones by selected theme IDs if any
            const filteredTones = data.tones.filter(tone => 
                selectedIds.themeIds.length === 0 || selectedIds.themeIds.includes(tone.id)
            );
            const toneCounts = filteredTones.reduce((acc, tone) => {
                acc[tone.tone] = (acc[tone.tone] || 0) + 1;
                return acc;
            }, { positive: 0, negative: 0 });
            toneChart.data.labels = Object.keys(toneCounts);
            toneChart.data.datasets[0].data = Object.values(toneCounts);
            toneChart.update();
        }

        // Initially show all data
        updateCharts();

    </script>

</body>
</html>
